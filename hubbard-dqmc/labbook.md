# 2022.4.28

从旧代码里面找来了一个Hubbard DQMC的程序`hubbard-old-code.jl`，看看能不能修改得generic一些。

先测试一下能不能用：取$U=1$，输出为
```
T -1.4777923120276673 0.004471842143327594
Mott 0.20837948635182507 0.000888249213972672
```
第一列为平均值，第二位为标准差。

在`hubbard-old-code-renamed.jl`中修改一些名称，使得后续的模块化更容易进行。
修改了一部分，取$U=2$，有

```
Progress: 100%|████████████████████████████████████████████████████████████████████| Time: 0:14:43
T -1.431692758497201 0.0051304951942906215
Mott 0.1799663182632188 0.0011940302855397808
```

初步计划：
- 将主循环移动到`main.jl`
- 构建格点的移动到`lattice.jl`
- 理想情况下，可以先写一个generic的版本用来计算$\ee^{- \Delta \tau T}$，然后写一个专属于正方晶格的版本做checkboard decomposition。

# 2022.4.30

目前还没有做的事情：
- 将自旋上和自旋下的各种函数合并（是否有这个必要？性能overhead？）

提交
```
U = 4.0
β = 4.0
```
的任务，slurm id为1262582。输出为`slurm-1262582.out`，应该是没啥问题。

将checkboard decomposition的无用代码（它们应该在计算$\exp(-\Delta \tau \bold{T})$乘以别的矩阵时出现，现在我先把$\exp(-\Delta \tau \bold{T})$算好存起来，那用不用checkboard decomposition没有差别）注释掉，重新做计算，扩大规模。

目前的规模：
```julia
L = 10 
lattice = SquareLattice2D(L)
n_sites = lattice.n_sites

t = 1.0
U = 4.0
β = 4.0
n_imtimes = 100
n_wrap = 10

n_heat = 1000
n_sweep = 4000

n_bin = 10
```

更新服务器上的代码，跑一下试一试。slurm id为1263693。

似乎`println`更新不及时；加入了一些`flush(stdout)`语句，再看看。
此时
```
t = 1.0
U = 2.0
β = 4.0
```
slurm id为1265098。

1265098超时了。看来最好还是从$L=4$开始做。

可以做的事情：
- 计算$L=10$时扫一次要多久

运行
```julia
@time sweep!(model, 1)
```
得到
```
 33.939589 seconds (3.29 M allocations: 12.192 GiB, 2.80% gc time)
```
确实很长……

按照
```julia
L = 10 
lattice = SquareLattice2D(L)
n_sites = lattice.n_sites

t = 1.0
U = 4.0
β = 4.0
n_imtimes = 100
n_wrap = 10

n_heat = 1000
n_sweep = 4000

n_bin = 10
```
的规模，总计扫了$1000 + 10 \times 4000 = 41000$次，需要的时间是
```julia
33.939589 * 41000 / 3600
```
也就是386个小时！预热的时间也要9小时。

我觉得我还是试一试不同的$L$下扫一次需要的时间为好。

| $L$ | 时间(s) |
| :------ | :------ |
| 4 | 0.735203 |
| 5 | 1.568580 |
| 6 | 2.041254 |
| 7 | 7.743210 |
| 8 | 12.953749 |
| 9 | 20.645465 |
| 10 | 33.939589 |

这意味着$L=4$的情况也需要8小时。

在加入磁化率计算之后，使用如下小规模计算：
```julia
#region Model parameters

t = 1.0
U = 2.0
β = 4.0

#endregion

#region Problem size

L = 4 
lattice = SquareLattice2D(L)
n_sites = lattice.n_sites
site_list = lattice.site_list

n_imtimes = 100
n_wrap = 10

#endregion

#region Sweeping control

n_heat = 100
n_sweep = 400
n_bin = 10

#endregion
```

似乎磁化那里有问题。（还没扫完，但是前两个bin都是0.07左右）设置$U=0$，只扫描一个bin，得到
```
Square lattice 2D Hubbard simple DQMC


t   =    1.0
U   =    0.0
β   =    4.0

n_sites   =   16
n_imtimes =   100
n_wrap    =   10

n_heat    =   100
n_sweep   =   400
n_bin     =   1

Heating up finished.


====================================================
E_kin            double_occ    magnetization
====================================================
-1.4993291872    0.2500000000    0.0507602959 

====================================================

E_kin      =   -1.4993291872038983 ± NaN
double_occ =   0.25000000000000255 ± NaN
mag        =   0.050760295887215943 ± NaN
```
然而`mag`那里应该是0.01才对。

看了xxy的代码，好像因为自旋1/2要乘以1/4.

# 2022.5.2

```
Square lattice 2D Hubbard simple DQMC


t   =    1.0
U   =    4.0
β   =    4.0

n_sites   =   16
n_imtimes =   80
n_wrap    =   10

n_heat    =   256
n_sweep   =   500
n_bin     =   10

Heating up finished.


====================================================
E_kin            double_occ    magnetization
====================================================
-1.2883900103    0.1263416438    0.0250162846 
-1.3265434500    0.1263442690    0.0241612521 
-1.3294948606    0.1297493972    0.0232511839 
-1.2984369824    0.1261373714    0.0230808026 
-1.3168504913    0.1273670216    0.0239027212 
-1.3318833696    0.1291119323    0.0238116144 
-1.3298143501    0.1283875584    0.0226089581 
-1.3229039686    0.1293443291    0.0246821311 
-1.3168847097    0.1246721660    0.0229960583 
-1.3164177116    0.1273062922    0.0242404025 

====================================================

E_kin      =   -1.3177619904159725 ± 0.014241814897954314
double_occ =   0.12747619810353122 ± 0.0016474852592948427
mag        =   0.023775140861315887 ± 0.000779587823173299
```
好像磁化还是不太对。按理说应该到0.4左右的。

不得了，
```
Square lattice 2D Hubbard simple DQMC


t   =    1.0
U   =    8.0
β   =    4.0

n_sites   =   16
n_imtimes =   80
n_wrap    =   10

n_heat    =   256
n_sweep   =   500
n_bin     =   10

Heating up finished.


====================================================
E_kin            double_occ    magnetization
====================================================
-1.3098040481    0.0853053024    0.0250521394
-1.3351000077    0.0822370305    0.0266899579
-1.3279017986    0.0780042056    0.0262938533
-1.3296764764    0.0860492974    0.0267774410
-1.2993335280    0.0784472301    0.0266273681 
-1.3009280277    0.0838030757    0.0266839978 
-1.2911186243    0.0842881694    0.0253331564 
-1.3188339145    0.0834682716    0.0263674546 
-1.3265920283    0.0829677562    0.0254058166 
-1.3253439059    0.0794912459    0.0275272224 

====================================================

E_kin      =   -1.3164632359508972 ± 0.015133855566759936
double_occ =   0.08240615848402601 ± 0.0028321553997072996
mag        =   0.026275840740776962 ± 0.0007768149917073065
```
好像能量也是错的。

为了检查什么地方有问题，运行`hubbard-old-code.jl`观察。取`U = 8.0`：输出为
```
Progress: 100%|████████████████████████████████████████████████████████████████████| Time: 0:11:59
T -1.3325295647020048 0.017945595434198054
Mott 0.08478973723069207 0.0020585114638910075
```

因此出问题的是从`hubbard-old-code.jl`出发开发得到的所有代码。

我翻箱倒柜找出来一份（至少是动能部分）能用的python代码，见`hubbard-first-workable.ipynb`。

修改`hubbard-dqmc\old-code-1\observe.jl`来加入双占据和磁化率。

这个是`U=4`的结果：
```
Observables:
-1.386758269199109    0.1273138964821045    0.018489855621334022 - 4.453712996395483e-34im
-1.091704819170557    0.10858478261572828    0.005397459313792592 + 2.6481536735324493e-34im
-1.2505778003427    0.12831190793975064    0.0069882008880233736 - 1.925929944387236e-34im
-0.856805508013271    0.07840708962484642    0.09869432093298189 + 3.1476917528578886e-33im
-1.4441316307480951    0.13604924882398164    0.06319243550840957 - 3.562970397116386e-33im
-1.3459642244878807    0.15292379674670178    0.011080264091162847 - 8.125016952883651e-35im
-1.6126020277577149    0.14294948831622148    0.008828644681578688 + 4.333342374871281e-34im
-1.2824036996071433    0.11898478502095616    0.009294689681281105 + 1.1886598875514971e-34im
-1.3564575306617304    0.15671368765794372    0.018657245634200844 + 3.1898214703913594e-34im
-1.5728057091868854    0.11549655399571956    0.06042086191714472 + 9.990761586508786e-34im
-0.9722419024461892    0.07964070328763057    0.026959303729339943 + 3.912045199536573e-34im
-0.9927315266002052    0.09573539594665947    0.013449915357943399 + 5.416677968589101e-34im
-1.5242154377373782    0.13814523413798352    0.010226997486126984 - 4.81482486096809e-34im
-1.707945207445699    0.14384932930555636    0.00738739743448671 - 6.357073449246931e-35im
-1.0441940441647268    0.06666693017213228    0.022404745058449416 + 6.138901697734314e-34im
-1.2632746261686814    0.15079422154179806    0.014856131452622748 - 6.319457630020618e-35im
-1.501596031193834    0.1585392627303986    0.013711020653898115 - 4.724546894824938e-34im
-1.3521825577906266    0.12747190796807606    0.00665511954994903 + 6.018531076210112e-35im
-1.0585830813663235    0.10734340568459076    0.03463232446733806 + 2.8888949165808538e-34im
-1.1067857758591075    0.10704004398150374    0.06515240494012324 + 2.2689862157312122e-33im
-1.3653974212223008    0.1497178651375587    0.03152175952744882 + 1.0833355937178202e-33im
-1.530540857286606    0.15141440007905665    0.01043942165466644 - 6.018531076210112e-35im
-1.6676518073259785    0.12453418505174652    0.05141494235190663 - 8.305572885169955e-34im
-1.279789948150936    0.10076236245516072    0.02116305107746056 - 3.1296361596292583e-34im
-1.2544096581548552    0.13092630667154617    0.034365969573973 - 8.666684749742561e-34im
-1.4072495300225754    0.12123625888590894    0.08344135918329172 - 3.2138955946962e-33im
-1.635395089237635    0.14899634873488038    0.007842505723090832 + 3.0393581934861066e-34im
-1.2365983940188645    0.11201636727948967    0.04009129422325051 + 2.840746667971173e-33im
-1.6008084089858294    0.14609543915566464    0.019780595651207284 + 6.710662149974275e-34im
-1.3215918677048994    0.11839935395227216    0.10671830647373909 - 1.0532429383367696e-33im
-1.195514068780496    0.1149720106152691    0.04353776648347747 + 6.229179663877466e-34im
-1.2853251954644382    0.0894738628999314    0.06716354635027916 - 2.6481536735324493e-34im
-1.122078408176372    0.11201352346908926    0.0621163016918309 - 8.666684749742561e-34im
-1.1252770829947558    0.11842037502112522    0.010979016960107868 + 5.115751414778595e-34im
-1.3363889965900464    0.12903877721474852    0.007165547860543699 + 1.4444474582904269e-34im
-1.275319204218795    0.1276557090894357    0.049706183428676505 + 1.239817401699283e-33im
-1.4510003910676244    0.1385862871888006    0.010470742896197262 + 2.6481536735324493e-34im
-1.086653278272005    0.10703831644269704    0.11730375260481336 + 4.2129717533470784e-34im
-1.2422166604926486    0.1482430403162402    0.03168485303146308 - 1.2638915260041235e-33im
-0.9445840655200782    0.10041203642267685    0.011288233646653618 - 5.296307347064899e-34im
-1.2995607330329548    0.1186227644351255    0.13214285428080436 + 8.943537179248226e-33im
-1.4275665819237378    0.1516372141050035    0.019753825875096716 + 3.611118645726067e-35im
-1.2826962936686686    0.13278929591547792    0.06880407548346396 - 1.0712985315654e-33im
-1.2156833785638996    0.10601952322303874    0.09541749486209149 + 9.810205654222483e-33im
-1.3262813616405627    0.15466508875573498    0.0194582063860352 + 6.500013562306921e-34im
-0.9741101524111964    0.09432148649083233    0.08203197804038315 - 3.803711640164791e-33im
-1.0833158557688338    0.1116021755435731    0.06476359146193014 - 4.55903729022916e-34im
-1.3521615264552738    0.1117210225098708    0.12096629131211893 - 1.9620411308444965e-33im
-1.1320067660720643    0.10993917609197575    0.125279167451156 + 8.341684071627215e-33im
-1.2970105764955404    0.11775768585245074    0.044102632446779734 + 3.851859888774472e-34im
-1.3076924000324368    0.13050774749078026    0.08403483639923912 + 1.2037062152420224e-33im
-1.375677014343375    0.12636623772238603    0.09720338255355818 - 7.2222372914521344e-34im
-1.350882989974761    0.11975426854280852    0.12924282592934663 + 3.1416732217816785e-33im
-1.4787361393582334    0.08469658144732291    0.1683118640709009 + 6.018531076210112e-35im
-1.2344905739170224    0.09141588121161784    0.15742065652036127 - 2.8768578544284336e-33im
-1.3950072307951944    0.08005124838135562    0.11648302536858847 + 6.391680002935139e-33im
-1.450725359284462    0.16046921993037475    0.009433856451860661 + 9.62964972193618e-34im
-1.934360675499192    0.16343865470207727    0.05341425537111059 + 6.018531076210112e-34im
-1.2876504194280725    0.10633577580002619    0.12038297396307537 + 1.4083362718331662e-33im
-1.351293994224839    0.13140106433747353    0.05085095173559678 + 6.2592723192585165e-34im
-1.4331166430138973    0.14144749362417058    0.061501817233246124 + 1.2157432773944426e-33im
-0.8868472014518194    0.08309590409668784    0.03186508169845393 + 1.0833355937178202e-34im
-1.365477750279556    0.1597674526842859    0.010591346189948973 + 9.027796614315168e-35im
-1.069333542072723    0.11490394915061355    0.009459129721337126 + 3.550933334963966e-34im
-1.1580288760141526    0.11963471312820691    0.02073100280591175 + 9.62964972193618e-35im
-1.3003102014555434    0.13256946878371545    0.05088620399162602 + 8.185202263645752e-34im
-1.5382452793738062    0.14414713344926894    0.0069261417048078035 + 9.62964972193618e-35im
-1.3434149825964916    0.15469781473925556    0.04212053995492734 - 1.7333369499485123e-33im
-1.300136157769283    0.13607749304702957    0.007114852179918539 - 2.0252357071447027e-33im
-1.3519310059634873    0.14860384367179022    0.00949256791743499 - 4.363435030252331e-34im
-1.4329729799817874    0.13888341981554123    0.007003189700387319 - 4.2129717533470784e-34im
-1.4683168941493339    0.1368691936049089    0.09856634807710665 - 3.069450848867157e-34im
-1.062425085406443    0.09997147880215124    0.06381789964292967 - 3.5750074592688066e-33im
-1.2418645673949436    0.1419266027785781    0.048705203356952165 + 3.322229154067982e-33im
-1.2145958596748505    0.12494304103267027    0.025485586072746556 - 3.129636159629258e-33im
-1.3013130736202347    0.12366064732171936    0.017887194733760513 + 1.023150282955719e-34im
-1.3769509251317906    0.13400057465829518    0.038436821883092956 + 4.694454239443887e-34im
-1.201321505321957    0.13216174705326017    0.014652730803910574 - 4.438666668704958e-34im
-1.171838053764517    0.140870517557414    0.012845312695834759 - 9.328723168125674e-35im
-1.7383754357179872    0.13093705585642673    0.11753626106568726 - 3.0814879110195774e-33im
-1.5713599960864078    0.1596691434244673    0.044066415978199776 - 5.657419211637505e-34im
-1.173606921276345    0.076234359556301    0.1407033302241125 + 4.718528363748728e-33im
-1.1783072865532576    0.09622853322564215    0.0565542402957543 + 5.657419211637505e-34im
-1.2827404773598032    0.12530244148018954    0.040174504011689476 - 3.4606553688208144e-34im
-1.2799030371891025    0.11831661013140767    0.04840693795874239 + 5.476863279351202e-34im
-1.390001226014281    0.11834108635661779    0.03997728938248693 - 7.462978534500539e-34im
-1.7428190967610653    0.15497386621199197    0.026436417626235144 - 6.2592723192585165e-34im
-1.226782100692735    0.1258358889557796    0.02244299215466254 - 3.942137854917623e-34im
-1.0043912896489724    0.09675227802631425    0.024043721969908824 + 9.990761586508786e-34im
-1.1066944315921612    0.08608982127691125    0.05458444699083425 + 1.3361138989186449e-33im
-0.8914543201246801    0.0790346851914729    0.09260057839747597 + 1.817596385015454e-33im
-1.6889794067283386    0.15533143122979987    0.0824630140850066 + 1.117189831021502e-33im
-1.2878240995167323    0.11408266329700592    0.13155367426732695 - 2.0041708483779673e-33im
-1.2651135254656114    0.0790376437725785    0.16513475170815453 - 3.903017402922258e-33im
-1.2260927254333458    0.11338269099535489    0.08842949056528175 - 8.546314128218359e-34im
-1.5006576300414034    0.1569716021262263    0.04304779849746588 - 6.18404068080589e-34im
-1.0174504007691754    0.06174132816668846    0.04222114609098226 - 8.06483164212155e-34im
-1.1965256010986138    0.05001812311853292    0.03606152931569236 - 2.2870418089598426e-34im
-1.4985754178962862    0.13155607959520485    0.01127367227443646 + 1.6851887013388314e-34im
-1.2352023294101988    0.12216534283474957    0.035288711760053305 + 2.0824117523686988e-33im
Binned Kinetic energy: -1.3036595910633904
```
我真的弱智，没看清楚就算了`U=4`。

改用`U=8`。
```
Observables:
-1.0672577136250523    0.07140283513297203    0.016600489902454104
-1.3592717255330358    0.08970877110554308    0.004583913491265618
-1.094405541054193    0.03823520750275488    0.038064970595690355
-0.6904091152473086    0.03409052579782335    0.011337050143638401
-1.2904895776891818    0.08205298703091043    0.004766769192507611
-2.487516559171748    0.03315332557931881    0.018316290227610086
-0.5789103811513002    0.04261017493843872    0.022604293525163927
-0.8144595016044369    0.0232344018248853    0.028108944119586206
-0.4796760275789939    0.02627448256417988    0.003856088436066101
-0.6938692354899839    0.04315705478518573    0.0029883637990841382
-0.4573354789886472    0.047695362349159214    0.00772139815853495
-1.0337563129663754    0.02126439612448929    0.006289539081908665
-1.123287359258038    0.045292416453520626    0.004426132060717703
-1.02164943328233    0.045449852394178335    0.0028650617459506146
-0.48763509418043893    0.043273924371591076    0.002421231435687345
-2.0155911706593455    0.08548127039833224    0.005961706567725994
-1.623785062427756    0.05790117557940062    0.06484251588170806
-0.5968167211935738    0.0402012564057365    0.03168566706936181
-0.691464919012508    -0.039180682961563046    0.005392822912592228
-1.4210219800602895    0.05282855105106633    0.007318446506509036
-0.9289438924628988    0.020735715473745326    0.08557990792662498
-1.5646163333194358    0.05407249917277538    0.033049800823649236
-0.5250229091325713    0.029511268117534885    0.004560104481747762
-1.3264085657922393    0.02179081564889665    0.00413210248426283
-0.8032709142554862    0.03271314763682813    0.00833990973635617
-0.9232392535815865    0.041982113188691814    0.006776831899054133
-0.6562978946513842    0.02070515257737274    0.003966394114886575
-0.6861313201535488    0.04353341249502715    0.003312024796808076
-1.2012565003539537    0.07664714664363212    0.011546189882548944
-0.7970774571525816    0.06433770366446998    0.0033922901268803683
-1.0083144040056298    0.05778685613751033    0.0027310006742284803
-0.5939000356751113    0.030919916562168116    0.006036183865476651
-1.1005856136441683    0.08496113115263249    0.00997193369695994
-0.5327980887086047    0.022204132178537127    0.006352851613068597
-0.9260751455628694    0.021940247268365878    0.005614583779870864
-0.9370997050151008    0.04816638617597053    0.016191777216234778
-0.6965165428019149    0.06621792387543142    0.003103691985921204
-0.4804518065638338    0.013154792244469948    0.01709413070873817
-1.0812945220066392    0.07329410114003437    0.010779920604727754
-0.6477275385185115    0.03533546091784384    0.011669912257961566
-0.2542124372588592    0.00904901273414322    0.01754932351792193
-0.5890962367823319    0.03116935057353875    0.019057324819868448
-0.49361745970302306    0.019203860501818534    0.012910942050560655
-1.3936803717136925    0.08131182909084737    0.0375825870093752
-2.7283642853670393    -0.6431194401255003    0.018654195004654102
-0.6225903750295378    0.017290256860376774    0.059640002032169834
-1.2928336167078531    0.10606987107866458    0.04584917715263044
-1.1593442611384548    0.06550860315347015    0.16535784802592524
-1.0168321453931828    0.07372483563458697    0.16939649996227812
-0.7724626745887277    0.03286396571291348    0.21658103773298454
-1.6401996144932387    0.09808723865187315    0.11389708671453959
-1.0719801390610524    0.07350621458679545    0.07929785874489795
-0.8123709095051652    0.021811273812247088    0.019132455397447824
-0.7835853393779839    0.04701274409052385    0.10714150539748174
-0.9671788563729887    0.03414107196176151    0.11579925602392885
-0.8155068038752494    0.03560443490854649    0.11525776987732099
-0.9259441324348572    0.050631874505431516    0.10481339589917606
-0.777355102288362    0.05039075708173119    0.043493220973482107
-0.5144712816802457    0.022387267695527575    0.055388329823935115
-1.1147724197523141    0.08095081794615579    0.141010141470354
-0.8300362581992955    0.03278813181013351    0.21892928826251093
-0.5547180473638913    0.009751267026224673    0.2408365219457365
-1.1397322174375093    0.05934025541375475    0.17680142814194344
-1.2668059055706447    0.058756015567594924    0.18984038159509964
-1.1467930443023    0.0359712515423358    0.21513096403842116
-1.4072922218779256    0.08243025408723563    0.09572550129546213
-1.1779659836981042    0.02389186560376077    0.12456500660551749
-2.204386790370103    0.07585044632854339    0.1682373081832834
-1.119010195906616    0.05232608915002716    0.16146461186333202
-1.2145743710291868    0.10310626718401146    0.061584500051348585
-1.2338445566709373    0.09605019989280471    0.08586326556730589
-0.8921100970309517    0.02181104881130586    0.22915975748782189
-1.0751823248369234    0.07019941679928504    0.18096106766745754
-0.7499605408179285    0.05509000396147052    0.174233622310171
-0.8609820072083432    0.0439096852282576    0.20329592602109842
-0.6017887674763351    0.013745432968817124    0.23706168959978652
-0.7362772684484203    0.03226072620329527    0.21766597669385557
-1.0365376725419333    0.045675406405594886    0.2041365598946876
-0.8125715597996168    0.023003982955726258    0.22805298076373137
-1.0731755986594786    0.05707895073243104    0.17599612051302047
-1.0375942142074337    0.0572206201978269    0.19451287983459264
-0.7717249561601287    0.019739212435312476    0.23124904035954935
-1.229902863456308    0.02714371614814239    0.22401846744372786
-1.0390718846927034    0.054833406933252095    0.19108642032167542
-1.2313360426759792    0.06376520934173821    0.1641932139769317
-0.919239824112682    0.06029623124182052    0.15799880550791323
-0.8449282448312814    0.019982396246367037    0.23105101934434263
-0.9736959699450873    0.05660514846261979    0.19156649185099303
-0.7929013659606252    0.03350993577466409    0.21528388510472174
-0.9830889351728342    0.0705534515906322    0.11059754071034529
-1.5778889519229597    0.11052400168530357    0.1254760903081574
-0.8930669199202048    0.04546473997952422    0.20419990557465803
-1.1035347478695594    0.07282932480259406    0.15566524359596526
-0.73222482305895    0.03866993683294019    0.1161265509158523
-0.8625053923760362    0.03838187460567506    0.11195980733226095
-0.6519612505600451    0.027495165759170624    0.062047597535093126
-0.5564139599643725    0.009444241686700203    0.13452996687684024
-0.9028031506619951    0.047315142350429884    0.1071199293910258
-1.292161682730737    0.08219442309328885    0.08060213335739061
-0.964081937356867    0.060487850541910214    0.1801272232320292
Binned Kinetic energy: -0.9868590836294 ± 0.40516526777676487
Binned double occupation: 0.040412257785378373 ± 0.07359126749426709
Magnetization: 0.0898111788623636 ± 0.08230151067851081
```
因此至少这个代码应该是能用的……

我想起来好像`old-code-1`代码是我后来改过的，无怪乎……

于是现在我们将来自`hubbard-old-code.jl`的代码打包放进`old-code-2`文件夹。
我们需要做的是将`old-code-2`和`old-code-1`结合起来，使用`old-code-2`的代码组织方式，内容还是`old-code-1`。

将`old-code-1`的内容复制出来。

尝试将lattice替换掉。（使用`old-code-2`）移除了原本手动计算的代码，做测试。

应该是没问题。这里$U=8$
```
Observables:
-1.6317112391194946    0.08472192027917823    0.016559767224498548
-0.7735339480296001    0.05680257114441483    0.012960476905189687
-1.3969239604736785    0.08460748208809189    0.004871789077362654
-0.6978537861519053    0.03846528041808516    0.003468989583930125
-0.7597029373471045    0.044573400225579804    0.016819935319744676
-1.2797040477808017    0.07345240485215143    0.020812741809907172
-0.9640903053026422    0.08891025623122126    0.02936800029275481
-0.41322152752696917    0.01528903257562668    0.004049226905364165
-0.5428481376092609    0.02722521258175821    0.003995865221215092
-0.6978565567922262    0.029174969337256416    0.006997822255777623
-1.082423347563536    0.043130052429798685    0.003286074189660179
-1.147469778834213    0.061573297610613135    0.0036865300943854833
-0.44241505604491516    0.01920057921630241    0.007058347523765607
-0.8676928887635238    0.042000039433840175    0.009737760624154844
-0.8223143686314052    0.054478752338533686    0.041855586865169235
-1.5167584273057855    0.0565103637402459    0.004538051790253286
-0.5784176616975656    0.03574427976190624    0.0087044073702723
-0.6881303006422278    0.03544419788595601    0.02536942821123161
-1.4908595842041574    0.03322572272221962    0.035888360566372124
-0.9757625404141339    0.058740151145026565    0.01873577122672418
-0.953793292157544    0.03889641502617852    0.032889138203181734
-1.0983151886547917    0.055746139021759664    0.0493592207840274
-0.9390096966880954    0.06828474922715384    0.09456054159091891
-0.7298908511576172    0.06073748510876205    0.021503342047329968
-0.646688291273551    0.04135566452782742    0.022853883577162098
-1.344412359540092    0.0512678535635563    0.019822120251434847
-1.2983143256198248    0.05855781763933073    0.02266364518455883
-1.0628590236813382    0.08539174900325575    0.006608809382566496
-1.1933809061855325    0.049208668892375455    0.020339144983478028
-1.0306256838350571    0.09491528550567743    0.010558920670681227
-0.44075590774083484    -0.008405978707621801    0.051649488803204156
-1.0904202651202466    0.08167723722697048    0.011033877743107613
-1.0177240099802907    0.057058154764444535    0.01704681787584167
-0.6074141026889397    0.05733927288413837    0.027725882672407234
-0.8666368595597336    0.02064706509323965    0.035503431952781106
-0.48271304255785696    0.02351204296159876    0.02791903215046995
-0.6015216501198642    0.04600459219646906    0.008914455476785578
-0.5181042013288076    0.023829202595580495    0.0031290083480354862
-0.45685692749277274    0.02415891448979593    0.005187615673178414
-1.2391940808088013    0.025410579487713983    0.003060858464238444
-0.6268948791108934    0.04940399467825414    0.06680667086103233
-0.8222057490344682    0.04448346995316504    0.002558730178978552
-0.43741398896253747    0.014472643969835195    0.003984004464305271
-1.116958117599975    0.048982515195126745    0.0032025537145655603
-0.4191213305325328    0.028022481123328186    0.00416931486154979
-0.3058473527731904    0.008675911335960634    0.0037905534149998625
-0.5209966901606948    0.022831526571216395    0.003494846855399441
-1.0138223541073534    0.05059332642937085    0.004732541903290206
-0.5190305009395072    0.05377747781096412    0.005490256146879028
-1.0728044931395662    0.026012778376922462    0.01895049654419812
-1.8790258106416227    0.06341381424181196    0.008427555280462773
-1.3575433007756004    0.0830003896723553    0.0261713587755468
-0.9796712614153462    0.062187787505811845    0.04307148857051131
-1.6265582716268847    0.08135057538705007    0.05618415420612202
-0.8637362776175856    0.0349322468620471    0.02214549448004476
-0.46477181726915623    0.018742786561851434    0.05670054909656334
-0.7122110472262417    0.011379222792362982    0.058239147800724755
-0.7430011212754162    0.03476788270372625    0.047868910086889635
-0.6135545201060753    0.0305974149444057    0.017221990915494107
-0.9322824088385386    0.0730588218189028    0.00402717364073364
-0.5113919959282693    0.041219194531609354    0.00427107280200883
-0.5283984920607663    0.014860377644506016    0.0007588038870729629
-0.8391793627413803    0.04933597800692622    0.019996000487483217
-1.182074597860367    0.03433343734844869    0.05198400726785855
-0.9442186086843927    0.06362694748117242    0.0059142873946865515
-0.5521979717174926    0.033509646546995404    0.0030622404711373582
-0.808652083123091    0.054779484708658024    0.003613849987762157
-0.5185682446109584    0.03761389219940896    0.02444610096427555
-0.8434219908096617    0.036872554450337575    0.04803173823623572
-1.4119553097970896    0.06903728862915595    0.023884269342751206
-0.7094500650402695    0.026670516342353165    0.11878114612118526
-1.298522603072332    0.09392906381503097    0.05933578496418857
-1.0326491411150487    0.021962826499785395    0.1257927839303072
-1.1407792317115053    0.05118217806630995    0.06170935504012785
-1.1087172186594207    0.042536619954369394    0.044210662850331275
-1.0902242829733644    0.07541325716079929    0.007580642881800524
-0.711613240653467    0.052931286005192466    0.01762848144150293
-1.1346870470847306    0.06649183346690817    0.03390701306397807
-0.7546581951641239    0.04749422280025596    0.1487384407785932
-0.8772655026967395    0.06943237895124994    0.11522348158793637
-0.5929632368232042    0.032605003241478164    0.1686362248637167
-0.7538689936191736    0.048558953042936386    0.1482895905663546
-1.8738205800344252    0.06488629832657253    0.011332376787277682
-1.0020768089665948    0.05941085063398494    0.1393680096366244
-0.6138578348534125    0.0246973662484585    0.17117702437491814
-0.8836781126190285    0.054395409619800994    0.16532130441074125
-1.4415250025492339    0.09442277267606762    0.04184284475514079
-0.38336939292211747    0.01008289215636349    0.05895525360408876
-0.582741078726998    0.011404720094556078    0.058544991674929596
-0.8419908924154434    0.016371191262817362    0.055887963209468136
-1.011832029161519    0.057329852073318366    0.031919482714745734
-0.7233466288603962    0.0680114627006484    0.06596625836473079
-0.4248269292101753    0.007899292458981633    0.061006870605051965
-1.037528808788856    0.05111001744151957    0.09873091178580173
-0.8544332762661464    0.05157706699796206    0.10290644879445683
-0.6810991879226802    0.03226569380097763    0.11677697600791542
-0.7463893777744703    0.01219688173095654    0.13226254679798946
-0.800146269287979    0.05055077945780116    0.1049085202686656
-1.156201539887324    0.04051381755740543    0.11333554303518296
-0.5109855320792237    0.02361091788874069    0.05972656237685798
Binned Kinetic energy: -0.8833107905785279 ± 0.33859781700676334
Binned double occupation: 0.04574684168481303 ± 0.02240208993968187
Magnetization: 0.04054097828827296 ± 0.04410623288029019
```
